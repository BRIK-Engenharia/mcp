<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Multiple Change Point Inference • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Bayesian Multiple Change Point Inference">
<meta property="og:description" content="Flexible inference of Multiple Change Points (MCP) between Hierarchical Generalized Linear Time-Series Segments - and the parameters in those segments.">
<meta property="og:image" content="https://lindeloev.github.io/mcp, https://github.com/lindeloev/mcp/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="mcp-multiple-change-point-regression" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#mcp-multiple-change-point-regression" class="anchor"></a>mcp: Multiple Change Point regression</h1></div>

<p>Infer Multiple Change Points (MCP) between Generalized Linear Segments using Bayesian hierarchical regression. <code>mcp</code> aims to provide maximum flexibility for analyses with a priori knowledge about the number of change points and the form of the segments in between.</p>
<p>Change points are also called <strong>switch points</strong>, <strong>break points</strong>, <strong>broken line</strong> regression, <strong>broken stick</strong> regression, <strong>bilinear</strong> regression, <strong>piecewise linear regression</strong>, <strong>local linear regression</strong>, <strong>segmented regression</strong>, and (performance) <strong>discontinuity</strong> models. <code>mcp</code> aims to be be useful for all of them. See how <code>mcp</code> compares to <a href="https://lindeloev.github.io/mcp/articles/packages.html">other R packages</a>.</p>
<p>Under the hood, <code>mcp</code> takes a formula-representation of linear segments and turns it into <a href="https://sourceforge.net/projects/mcmc-jags/">JAGS</a> code. <code>mcp</code> leverages the power of <code>tidybayes</code>, <code>bayesplot</code>, <code>coda</code>, and <code>loo</code> to make change point analysis easy and powerful.</p>
</div>
<div id="install" class="section level1">
<h1 class="hasAnchor">
<a href="#install" class="anchor"></a>Install</h1>
<ol>
<li><p><a href="https://sourceforge.net/projects/mcmc-jags/" target="_blank">Install the latest version of JAGS</a>. Linux users can fetch binaries <a href="http://mcmc-jags.sourceforge.net/" target="_blank">here</a>.</p></li>
<li>
<p>Install <code>mcp</code> by running this in R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"remotes"</span>)) <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span>(<span class="st">"lindeloev/mcp"</span>)</a></code></pre></div>
</li>
</ol>
</div>
<div id="brief-example" class="section level1">
<h1 class="hasAnchor">
<a href="#brief-example" class="anchor"></a>Brief example</h1>
<p><code>mcp</code> takes a list of formulas - one for each segment. The change point(s) are the <code>x</code> at which data changes from being better predicted by one formula to the next. The first formula is just <code>response ~ predictors</code> and the most common formula for segment 2+ would be <code>~ predictors</code> (more details <a href="https://lindeloev.github.io/mcp/articles/formulas.html">here</a>).</p>
<div id="fit-a-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-a-model" class="anchor"></a>Fit a model</h2>
<p>The following model infers the two change points between three segments.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mcp)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co"># Define the model</span></a>
<a class="sourceLine" id="cb2-4" title="4">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb2-5" title="5">  response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,  <span class="co"># plateau (int_1)</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>time,  <span class="co"># joined slope (time_2) at cp_1</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>time  <span class="co"># disjoined slope (int_3, time_3) at cp_2</span></a>
<a class="sourceLine" id="cb2-8" title="8">)</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co"># Fit it. The `ex_demo` dataset is included in mcp</span></a>
<a class="sourceLine" id="cb2-11" title="11">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, <span class="dt">data =</span> ex_demo)</a></code></pre></div>
</div>
<div id="see-results" class="section level2">
<h2 class="hasAnchor">
<a href="#see-results" class="anchor"></a>See results</h2>
<p>Plot lines drawn randomly from the posterior on top of data to inspect the fit:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_demo.png"></p>
<p>Use <code><a href="reference/summary.mcpfit.html">summary()</a></code> to summarise the posterior distribution as well as sampling diagnostics. They were simulated to lie at <code>cp_1 = 30</code> and <code>cp_2 = 70</code> and these values are well recovered, as are the other coefficients (<a href="https://github.com/lindeloev/mcp/tree/master/data-raw/ex_demo.R">see how <code>ex_demo</code> was generated</a>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="reference/summary.mcpfit.html">summary</a></span>(fit)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">Family<span class="op">:</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span>(<span class="dt">link =</span> <span class="st">'identity'</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">Iterations<span class="op">:</span><span class="st"> </span><span class="dv">9000</span> from <span class="dv">3</span> chains.</a>
<a class="sourceLine" id="cb5-3" title="3">Segments<span class="op">:</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="dv">1</span><span class="op">:</span><span class="st"> </span>response <span class="op">~</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dv">2</span><span class="op">:</span><span class="st"> </span>response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>time</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dv">3</span><span class="op">:</span><span class="st"> </span>response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>time</a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">Population<span class="op">-</span>level parameters<span class="op">:</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">    </span>name   mean  lower   upper Rhat n.eff    ts_se</a>
<a class="sourceLine" id="cb5-10" title="10">    cp_<span class="dv">1</span> <span class="fl">31.167</span> <span class="fl">23.620</span> <span class="fl">39.7257</span> <span class="fl">1.01</span>   <span class="dv">342</span> <span class="fl">407.6290</span></a>
<a class="sourceLine" id="cb5-11" title="11">    cp_<span class="dv">2</span> <span class="fl">69.772</span> <span class="fl">69.305</span> <span class="fl">70.2656</span> <span class="fl">1.00</span>  <span class="dv">5801</span>   <span class="fl">0.1389</span></a>
<a class="sourceLine" id="cb5-12" title="12">   int_<span class="dv">1</span> <span class="fl">10.333</span>  <span class="fl">8.895</span> <span class="fl">11.6919</span> <span class="fl">1.00</span>  <span class="dv">1063</span>   <span class="fl">3.8640</span></a>
<a class="sourceLine" id="cb5-13" title="13">   int_<span class="dv">3</span>  <span class="fl">0.534</span> <span class="fl">-2.499</span>  <span class="fl">3.5264</span> <span class="fl">1.01</span>   <span class="dv">735</span>  <span class="fl">31.7620</span></a>
<a class="sourceLine" id="cb5-14" title="14"> sigma_<span class="dv">1</span>  <span class="fl">4.013</span>  <span class="fl">3.441</span>  <span class="fl">4.6238</span> <span class="fl">1.00</span>  <span class="dv">4655</span>   <span class="fl">0.1849</span></a>
<a class="sourceLine" id="cb5-15" title="15">  time_<span class="dv">2</span>  <span class="fl">0.547</span>  <span class="fl">0.407</span>  <span class="fl">0.6961</span> <span class="fl">1.01</span>   <span class="dv">366</span>   <span class="fl">0.1369</span></a>
<a class="sourceLine" id="cb5-16" title="16">  time_<span class="dv">3</span> <span class="fl">-0.220</span> <span class="fl">-0.393</span> <span class="fl">-0.0443</span> <span class="fl">1.01</span>   <span class="dv">740</span>   <span class="fl">0.0992</span></a></code></pre></div>
<p><code>rhat</code> is the <a href="https://www.rdocumentation.org/packages/coda/versions/0.19-3/topics/gelman.diag">Gelman-Rubin convergence diagnostic</a>, <code>eff</code> is the <a href="https://mc-stan.org/docs/2_18/reference-manual/effective-sample-size-section.html">effective sample size</a>, and <code>ts_se</code> is the time-series standard error.</p>
<p><code><a href="reference/plot.mcpfit.html">plot(fit, "combo")</a></code> can be used to inspect the posteriors and convergence of all parameters. See the documentation of <code><a href="reference/plot.mcpfit.html">plot()</a></code> for many other plotting options. Here, we plot just the (population-level) change points. They often have “strange” posterior distributions, highlighting the need for a computational approach:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit, <span class="st">"combo"</span>, <span class="dt">regex_pars =</span> <span class="st">"cp_"</span>)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_demo_combo.png"></p>
</div>
<div id="tests-and-model-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#tests-and-model-comparison" class="anchor"></a>Tests and model comparison</h2>
<p>We can test (joint) probabilities in the model using <code><a href="reference/hypothesis.html">hypothesis()</a></code> (<a href="https://lindeloev.github.io/mcp/articles/comparison.html">see more here</a>). For example, what is the evidence (given priors) that the first change point is later than 25 against it being less than 25?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="reference/hypothesis.html">hypothesis</a></span>(fit, <span class="st">"cp_1 &gt; 25"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">     hypothesis    mean     lower    upper         p       BF</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="dv">1</span> cp_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="dv">25</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="fl">6.06081</span> <span class="fl">-1.510267</span> <span class="fl">14.01157</span> <span class="fl">0.9442222</span> <span class="fl">16.92829</span></a></code></pre></div>
<p>For model comparisons, we can fit a null model and compare the predictive performance of the two models using (approximate) leave-one-out cross-validation (<a href="https://lindeloev.github.io/mcp/articles/comparison.html">see more here</a>). Our null model omits the first plateau and change point, essentially testing the credence of that change point:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Define the model</span></a>
<a class="sourceLine" id="cb9-2" title="2">segments_null =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb9-3" title="3">  response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>time,  <span class="co"># intercept (int_1) and slope (time_1)</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>time  <span class="co"># disjoined slope (int_2, time_1)</span></a>
<a class="sourceLine" id="cb9-5" title="5">)</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co"># Fit it</span></a>
<a class="sourceLine" id="cb9-8" title="8">fit_null =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments_null, ex_demo)</a></code></pre></div>
<p>Leveraging the power of <code><a href="https://mc-stan.org/loo/reference/loo.html">loo::loo</a></code>, we see that the two-change-points model is preferred (it is on top), but the <code>elpd_diff / se_diff</code> ratio ratio indicate that this preference is not very strong.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">fit<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="reference/criterion.html">loo</a></span>(fit)</a>
<a class="sourceLine" id="cb10-2" title="2">fit_null<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="reference/criterion.html">loo</a></span>(fit_null)</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">loo<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span>(fit<span class="op">$</span>loo, fit_null<span class="op">$</span>loo)</a></code></pre></div>
<pre><code>       elpd_diff se_diff
model1  0.0       0.0   
model2 -7.8       4.7   </code></pre>
</div>
</div>
<div id="highlights-from-in-depth-guides" class="section level1">
<h1 class="hasAnchor">
<a href="#highlights-from-in-depth-guides" class="anchor"></a>Highlights from in-depth guides</h1>
<p>The articles on the <a href="https://lindeloev.github.io/mcp">mcp website</a> go in-depth with the functionality of <code>mcp</code>. Here is an executive summary, to give you a quick sense of what mcp can do.</p>
<p><a href="https://lindeloev.github.io/mcp/articles/formulas.html">About mcp formulas and models</a>:</p>
<ul>
<li>Parameter names are <code>int_i</code> (intercepts), <code>cp_i</code> (change points), <code>x_i</code> (slopes), <code>phi_i</code> (autocorrelation), and <code>sigma_*</code> (variance).</li>
<li>The change point model is basically an <code>ifelse</code> model.</li>
<li>Use <code>rel()</code> to specify that parameters are relative to those corresponding in the previous segments.</li>
<li>Generate data using <code>fit$func_y</code>.</li>
</ul>
<p><a href="https://lindeloev.github.io/mcp/articles/priors.html">Using priors</a>:</p>
<ul>
<li>See priors in <code>fit$prior</code>.</li>
<li>Set priors using <code>mcp(..., prior = list(cp_1 = "dnorm(0, 1)", cp_1 = "dunif(0, 45)")</code>.</li>
<li>Fix parameters to specific values using <code>cp_1 = 45</code>.</li>
<li>Share parameters between segments using <code>slope_1 = "slope_2"</code>.</li>
<li>Truncate priors using <code><a href="https://rdrr.io/r/base/logical.html">T(lower, upper)</a></code>, e.g., <code>int_1 = "dnorm(0, 1) T(0, )"</code>. <code>mcp</code> applies this automatically to change point priors to enforce order restriction. This is true for <a href="https://lindeloev.github.io/mcp/articles/varying.html">varying change points</a> too.</li>
<li>Do prior predictive checks using <code><a href="reference/mcp.html">mcp(segments, data, sample="prior")</a></code>.</li>
</ul>
<p><a href="https://lindeloev.github.io/mcp/articles/varying.html">Varying change points</a>:</p>
<ul>
<li>Simulate varying change points using <code>fit$func_y()</code>.</li>
<li>Get posteriors using <code><a href="reference/ranef.html">ranef(fit)</a></code>.</li>
<li>Plot using <code><a href="reference/plot.mcpfit.html">plot(fit, facet_by="my_group")</a></code> and <code><a href="reference/plot.mcpfit.html">plot(fit, "dens_overlay", pars = "varying", ncol = 3)</a></code>.</li>
<li>The default priors restrict varying change points to lie between the two adjacent change points.</li>
</ul>
<p><code>mcp</code> currently supports the following GLM:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/family.html">gaussian(link = "identity")</a></code> (default). See examples above and below.</li>
<li>
<code><a href="https://rdrr.io/r/stats/family.html">binomial(link = "logit")</a></code>. See <a href="https://lindeloev.github.io/mcp/articles/binomial.html">binomial change points in mcp</a>.</li>
<li>
<code><a href="reference/bernoulli.html">bernoulli(link = "logit")</a></code>. See <a href="https://lindeloev.github.io/mcp/articles/binomial.html">binomial change points in mcp</a>.</li>
<li>
<code><a href="https://rdrr.io/r/stats/family.html">poisson(link = "log")</a></code>. See <a href="https://lindeloev.github.io/mcp/articles/poisson.html">Poisson change points in mcp</a>.</li>
</ul>
<p><a href="https://lindeloev.github.io/mcp/articles/comparison.html">Model comparison and hypothesis testing</a>:</p>
<ul>
<li>Do Leave-One-Out Cross-Validation using <code><a href="reference/criterion.html">loo(fit)</a></code> and <code><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo::loo_compare(fit1$loo, fit2$loo)</a></code>.</li>
<li>Compute Savage-Dickey density rations using <code><a href="reference/hypothesis.html">hypothesis(fit, "cp_1 = 40")</a></code>.</li>
<li>Leverage directional and conditional tests to assess interval hypotheses (<code><a href="reference/hypothesis.html">hypothesis(fit, "cp_1 &gt; 30 &amp; cp_1 &lt; 50")</a></code>), combined hypotheses (<code><a href="reference/hypothesis.html">hypothesis(fit, "cp_1 &gt; 30 &amp; int_1 &gt; int_2")</a></code>), etc.</li>
</ul>
<p>Modeling <a href="https://lindeloev.github.io/mcp/articles/variance.html">variance</a> and <a href="https://lindeloev.github.io/mcp/articles/arma.html">autoregression</a>:</p>
<ul>
<li>
<code>~ sigma(1)</code> models an intercept change in variance. <code>~ sigma(0 + x)</code> models increasing/decreasing variance.</li>
<li>
<code>~ ar(N)</code> models Nth order autoregression on residuals. <code>~ar(N, 0 + x)</code> models increasing/decreasing autocorrelation.</li>
<li>You can model anything for <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> and <code><a href="https://rdrr.io/r/stats/ar.html">ar()</a></code>. For example, <code>~ x + sigma(1 + x + I(x^2))</code> models polynomial change in variance with <code>x</code> on top of a slope on the mean.</li>
<li>
<code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> and <code><a href="https://rdrr.io/r/stats/ar.html">ar()</a></code> apply to varying change points too.</li>
</ul>
<p><a href="https://lindeloev.github.io/mcp/articles/debug.html">Tips, tricks, and debugging</a></p>
<ul>
<li>Speed up fitting using <code><a href="reference/mcp.html">mcp(..., cores = 3)</a></code> / <code><a href="https://rdrr.io/r/base/options.html">options(mcp_cores = 3)</a></code>, and/or <code><a href="reference/mcp.html">mcp(..., adapt = 500, update = 500)</a></code>.</li>
<li>Help convergence along using <code><a href="reference/mcp.html">mcp(..., inits = list(cp_1 = 20, int_2 = -3))</a></code>.</li>
<li>Most errors will be caused by circularly defined priors.</li>
</ul>
</div>
<div id="some-examples" class="section level1">
<h1 class="hasAnchor">
<a href="#some-examples" class="anchor"></a>Some examples</h1>
<p><code>mcp</code> aims to support a wide variety of models. Here are some example models for inspiration.</p>
<div id="two-plateaus" class="section level2">
<h2 class="hasAnchor">
<a href="#two-plateaus" class="anchor"></a>Two plateaus</h2>
<p>Find the single change point between two plateaus (<a href="https://github.com/lindeloev/mcp/tree/master/data-raw/ex_plateaus.R">see how this data was generated</a>)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb12-2" title="2">    y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,  <span class="co"># plateau (int_1)</span></a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="op">~</span><span class="st"> </span><span class="dv">1</span>  <span class="co"># plateau (int_2)</span></a>
<a class="sourceLine" id="cb12-4" title="4">)</a>
<a class="sourceLine" id="cb12-5" title="5">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_plateaus, <span class="dt">par_x =</span> <span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_plateaus.png"></p>
</div>
<div id="varying-change-points" class="section level2">
<h2 class="hasAnchor">
<a href="#varying-change-points" class="anchor"></a>Varying change points</h2>
<p>Here, we find the single change point between two joined slopes. While the slopes are shared by all participants, the change point varies by <code>id</code>.</p>
<p>Read more about <a href="https://lindeloev.github.io/mcp/articles/varying.html">varying change points in mcp</a> and <a href="https://github.com/lindeloev/mcp/tree/master/data-raw/ex_varying.R">see how this data was generated</a>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x,  <span class="co"># intercept + slope</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>id) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x  <span class="co"># joined slope, varying by id</span></a>
<a class="sourceLine" id="cb13-4" title="4">)</a>
<a class="sourceLine" id="cb13-5" title="5">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_varying)</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit, <span class="dt">facet_by =</span> <span class="st">"id"</span>)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_varying.png"></p>
<p>Summarise the individual change points using <code><a href="reference/ranef.html">ranef()</a></code> or plot them using <code><a href="reference/plot.mcpfit.html">plot(fit, "combo", "varying")</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="reference/ranef.html">ranef</a></span>(fit)</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">            name       mean      lower      upper     rhat  eff     ts_se</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="dv">1</span> cp_<span class="dv">1</span>_id[Benny] <span class="fl">-18.939028</span> <span class="fl">-21.662758</span> <span class="fl">-16.178849</span> <span class="fl">1.000739</span> <span class="dv">2539</span>  <span class="fl">4.801090</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="dv">2</span>  cp_<span class="dv">1</span>_id[Bill] <span class="fl">-10.932586</span> <span class="fl">-13.570255</span>  <span class="fl">-8.355125</span> <span class="fl">1.001008</span>  <span class="dv">709</span> <span class="fl">22.656037</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="dv">3</span>  cp_<span class="dv">1</span>_id[Cath]  <span class="fl">-3.868473</span>  <span class="fl">-6.161151</span>  <span class="fl">-1.534219</span> <span class="fl">1.000035</span>  <span class="dv">996</span> <span class="fl">24.755440</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="dv">4</span>  cp_<span class="dv">1</span>_id[Erin]   <span class="fl">6.298535</span>   <span class="fl">3.689802</span>   <span class="fl">9.089925</span> <span class="fl">1.000215</span> <span class="dv">5308</span>  <span class="fl">2.047966</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="dv">5</span>  cp_<span class="dv">1</span>_id[John]   <span class="fl">9.742310</span>   <span class="fl">7.184306</span>  <span class="fl">12.258944</span> <span class="fl">1.000451</span> <span class="dv">1854</span>  <span class="fl">7.511643</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="dv">6</span>  cp_<span class="dv">1</span>_id[Rose]  <span class="fl">17.699242</span>  <span class="fl">14.393830</span>  <span class="fl">21.048751</span> <span class="fl">1.000152</span> <span class="dv">4019</span>  <span class="fl">4.435384</span></a></code></pre></div>
</div>
<div id="generalized-linear-models" class="section level2">
<h2 class="hasAnchor">
<a href="#generalized-linear-models" class="anchor"></a>Generalized linear models</h2>
<p><code>mcp</code> supports Generalized Linear Modeling. See extended examples using <a href="https://lindeloev.github.io/mcp/articles/binomial.html"><code><a href="https://rdrr.io/r/stats/family.html">binomial()</a></code></a> and <a href="https://lindeloev.github.io/mcp/articles/poisson.html"><code><a href="https://rdrr.io/r/stats/family.html">poisson()</a></code></a>. <a href="https://github.com/lindeloev/mcp/tree/master/data-raw/ex_binomial.R">See how this data was generated</a>.</p>
<p>Here is a binomial change point model with three segments. We plot the 95% HDI too:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb16-2" title="2">  y <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(N) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,  <span class="co"># constant rate</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x,  <span class="co"># joined changing rate</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x  <span class="co"># disjoined changing rate</span></a>
<a class="sourceLine" id="cb16-5" title="5">)</a>
<a class="sourceLine" id="cb16-6" title="6">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_binomial, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>())</a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit, <span class="dt">quantiles =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_binomial.png"></p>
<p>Use <code><a href="reference/plot.mcpfit.html">plot(fit, rate = FALSE)</a></code> if you want the points and fit lines on the original scale of <code>y</code> rather than divided by <code>N</code>.</p>
</div>
<div id="time-series" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series" class="anchor"></a>Time series</h2>
<p><code>mcp</code> allows for flexible time series analysis with autoregressive residuals of arbitrary order. Below, we model a change from a plateau to a slope with the same AR(2) residuals in both segments. We get However, you can specify different AR(N) structures in each segment and do regression on the AR coefficients themselves using e.g., <code><a href="https://rdrr.io/r/stats/ar.html">ar(1, 1 + x)</a></code>. <a href="https://lindeloev.github.io/mcp/articles/arma.html">Read more here</a>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb17-2" title="2">  price <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/ar.html">ar</a></span>(<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb17-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>time</a>
<a class="sourceLine" id="cb17-4" title="4">)</a>
<a class="sourceLine" id="cb17-5" title="5">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_ar)</a>
<a class="sourceLine" id="cb17-6" title="6"><span class="kw"><a href="reference/summary.mcpfit.html">summary</a></span>(fit)</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">Population<span class="op">-</span>level parameters<span class="op">:</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">    </span>name    mean   lower   upper Rhat n.eff    ts_se</a>
<a class="sourceLine" id="cb18-3" title="3">   ar1_<span class="dv">1</span>   <span class="fl">0.463</span>   <span class="fl">0.346</span>   <span class="fl">0.579</span> <span class="fl">1.00</span>  <span class="dv">1967</span> <span class="fl">1.31e-02</span></a>
<a class="sourceLine" id="cb18-4" title="4">   ar2_<span class="dv">1</span>   <span class="fl">0.258</span>   <span class="fl">0.133</span>   <span class="fl">0.369</span> <span class="fl">1.00</span>  <span class="dv">1772</span> <span class="fl">1.84e-02</span></a>
<a class="sourceLine" id="cb18-5" title="5">    cp_<span class="dv">1</span> <span class="fl">170.059</span> <span class="fl">151.960</span> <span class="fl">186.093</span> <span class="fl">1.05</span>   <span class="dv">231</span> <span class="fl">3.70e+03</span></a>
<a class="sourceLine" id="cb18-6" title="6">   int_<span class="dv">1</span>  <span class="fl">17.991</span>  <span class="fl">15.096</span>  <span class="fl">20.729</span> <span class="fl">1.01</span>   <span class="dv">586</span> <span class="fl">3.36e+01</span></a>
<a class="sourceLine" id="cb18-7" title="7"> sigma_<span class="dv">1</span>   <span class="fl">4.677</span>   <span class="fl">4.296</span>   <span class="fl">5.057</span> <span class="fl">1.00</span>  <span class="dv">5060</span> <span class="fl">7.08e-02</span></a>
<a class="sourceLine" id="cb18-8" title="8">  time_<span class="dv">2</span>   <span class="fl">0.456</span>   <span class="fl">0.370</span>   <span class="fl">0.549</span> <span class="fl">1.01</span>   <span class="dv">485</span> <span class="fl">4.13e-02</span></a></code></pre></div>
<p>As of <code>mcp</code> v0.2, plotting does not yet visualize the autocorrelation. The autocorrelated nature of the residuals are better shown using lines than points, so let’s tweak the default plot:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">plot_ar =<span class="st"> </span><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit_ar) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()  <span class="co"># Add line</span></a>
<a class="sourceLine" id="cb19-2" title="2">plot_ar<span class="op">$</span>layers[[<span class="dv">1</span>]] =<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># Remove dots</span></a>
<a class="sourceLine" id="cb19-3" title="3">plot_ar</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_ar.png"></p>
</div>
<div id="variance-change-and-prediction-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#variance-change-and-prediction-intervals" class="anchor"></a>Variance change and prediction intervals</h2>
<p>You can model variance by adding a <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> term to the formula. The inside <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> can take everything that the formulas outside do. Read more in <a href="https://lindeloev.github.io/mcp/articles/variance.html">the article on variance</a>. The example below models two change points. The first is variance-only: variance abruptly increases and then declines linearly with <code>x</code>. The second change point is the stop of the variance-decline and the onset of a slope on the mean.</p>
<p>Effects on variance is best visualized using <em>prediction intervals</em>. See more in the documentation for <code><a href="reference/plot.mcpfit.html">plot.mcpfit()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb20-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x),</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb20-5" title="5">)</a>
<a class="sourceLine" id="cb20-6" title="6">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_variance, <span class="dt">cores =</span> <span class="dv">3</span>, <span class="dt">adapt =</span> <span class="dv">5000</span>, <span class="dt">updaet =</span> <span class="dv">5000</span>, <span class="dt">iter =</span> <span class="dv">5000</span>)</a>
<a class="sourceLine" id="cb20-7" title="7"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit, <span class="dt">quantiles =</span> <span class="ot">TRUE</span>, <span class="dt">quantiles_type =</span> <span class="st">"predict"</span>)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_variance.png"></p>
</div>
<div id="quadratic-and-other-exponentiations" class="section level2">
<h2 class="hasAnchor">
<a href="#quadratic-and-other-exponentiations" class="anchor"></a>Quadratic and other exponentiations</h2>
<p>Write exponents as <code><a href="https://rdrr.io/r/base/AsIs.html">I(x^N)</a></code>. E.g., quadratic <code><a href="https://rdrr.io/r/base/AsIs.html">I(x^2)</a></code>, cubic <code><a href="https://rdrr.io/r/base/AsIs.html">I(x^3)</a></code>, or some other power function <code><a href="https://rdrr.io/r/base/AsIs.html">I(x^1.5)</a></code>. The example below detects the onset of linear + quadratic growth. This is often called the BLQ model (Broken Line Quadratic) in nutrition research.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb21-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(x<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb21-4" title="4">)</a>
<a class="sourceLine" id="cb21-5" title="5">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_quadratic)</a>
<a class="sourceLine" id="cb21-6" title="6"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_quadratic.png"></p>
</div>
<div id="trigonometric-and-others" class="section level2">
<h2 class="hasAnchor">
<a href="#trigonometric-and-others" class="anchor"></a>Trigonometric and others</h2>
<p>You can use <code><a href="https://rdrr.io/r/base/Trig.html">sin(x)</a></code>, <code><a href="https://rdrr.io/r/base/Trig.html">cos(x)</a></code>, and <code><a href="https://rdrr.io/r/base/Trig.html">tan(x)</a></code> to do trigonometry. This can be useful for seasonal trends and other periodic data. You can also do <code><a href="https://rdrr.io/r/base/Log.html">exp(x)</a></code>, <code><a href="https://rdrr.io/r/base/MathFun.html">abs(x)</a></code>, <code><a href="https://rdrr.io/r/base/Log.html">log(x)</a></code>, and <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt(x)</a></code>, but beware that the two latter will currently fail in segment 2+. Raise an issue if you need this.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb22-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(x),</a>
<a class="sourceLine" id="cb22-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(x) <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb22-4" title="4">)</a>
<a class="sourceLine" id="cb22-5" title="5"></a>
<a class="sourceLine" id="cb22-6" title="6">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_trig)</a>
<a class="sourceLine" id="cb22-7" title="7"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_trig.png"></p>
</div>
<div id="using-rel-and-priors" class="section level2">
<h2 class="hasAnchor">
<a href="#using-rel-and-priors" class="anchor"></a>Using <code>rel()</code> and priors</h2>
<p>Read more about <a href="https://lindeloev.github.io/mcp/articles/formulas.html">formula options</a> and <a href="https://lindeloev.github.io/mcp/articles/priors.html">priors</a> and <a href="https://github.com/lindeloev/mcp/tree/master/data-raw/ex_rel_prior.R">see how this data was generated</a>.</p>
<p>Here we find the two change points between three segments. The slope and intercept of segment 2 are parameterized relative to segment 1, i.e., modeling the <em>change</em> in intercept and slope since segment 1. So too with the second change point (<code>cp_2</code>) which is now the <em>distance</em> from <code>cp_1</code>.</p>
<p>Some of the default priors are overwritten. The first intercept (<code>int_1</code>) is forced to be 10, the slopes are in segment 1 and 3 is shared. It is easy to see these effects in the <code>ex_rel_prior</code> dataset because they violate it somewhat. The first change point has to be at <code>x = 20</code> or later.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">segments =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb23-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="kw">rel</span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">rel</span>(x),</a>
<a class="sourceLine" id="cb23-4" title="4">  <span class="kw">rel</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb23-5" title="5">)</a>
<a class="sourceLine" id="cb23-6" title="6"></a>
<a class="sourceLine" id="cb23-7" title="7">prior =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb23-8" title="8">  <span class="dt">int_1 =</span> <span class="dv">10</span>,  <span class="co"># Constant, not estimated</span></a>
<a class="sourceLine" id="cb23-9" title="9">  <span class="dt">x_3 =</span> <span class="st">"x_1"</span>,  <span class="co"># shared slope in segment 1 and 3</span></a>
<a class="sourceLine" id="cb23-10" title="10">  <span class="dt">int_2 =</span> <span class="st">"dnorm(0, 20)"</span>,</a>
<a class="sourceLine" id="cb23-11" title="11">  <span class="dt">cp_1 =</span> <span class="st">"dunif(20, 50)"</span>  <span class="co"># has to occur in this interval</span></a>
<a class="sourceLine" id="cb23-12" title="12">)</a>
<a class="sourceLine" id="cb23-13" title="13">fit =<span class="st"> </span><span class="kw"><a href="reference/mcp.html">mcp</a></span>(segments, ex_rel_prior, prior)</a>
<a class="sourceLine" id="cb23-14" title="14"><span class="kw"><a href="reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/ex_fix_rel.png"></p>
<p>Comparing the summary to the fitted lines in the plot, we can see that <code>int_2</code> and <code>x_2</code> are relative values:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw"><a href="reference/summary.mcpfit.html">summary</a></span>(fit)</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">Family<span class="op">:</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span>(<span class="dt">link =</span> <span class="st">'identity'</span>)</a>
<a class="sourceLine" id="cb25-2" title="2">Iterations<span class="op">:</span><span class="st"> </span><span class="dv">9000</span> from <span class="dv">3</span> chains.</a>
<a class="sourceLine" id="cb25-3" title="3">Segments<span class="op">:</span></a>
<a class="sourceLine" id="cb25-4" title="4"><span class="st">  </span><span class="dv">1</span><span class="op">:</span><span class="st"> </span>y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="dv">2</span><span class="op">:</span><span class="st"> </span>y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="kw">rel</span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">rel</span>(x)</a>
<a class="sourceLine" id="cb25-6" title="6">  <span class="dv">3</span><span class="op">:</span><span class="st"> </span>y <span class="op">~</span><span class="st"> </span><span class="kw">rel</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb25-7" title="7"></a>
<a class="sourceLine" id="cb25-8" title="8">Population<span class="op">-</span>level parameters<span class="op">:</span></a>
<a class="sourceLine" id="cb25-9" title="9"><span class="st">    </span>name  mean  lower upper Rhat n.eff    ts_se</a>
<a class="sourceLine" id="cb25-10" title="10">    cp_<span class="dv">1</span> <span class="fl">25.65</span>  <span class="fl">22.66</span> <span class="fl">30.71</span> <span class="fl">1.05</span>    <span class="dv">64</span>   <span class="fl">566.79</span></a>
<a class="sourceLine" id="cb25-11" title="11">    cp_<span class="dv">2</span> <span class="fl">48.68</span>  <span class="fl">42.77</span> <span class="fl">54.13</span> <span class="fl">1.01</span>   <span class="dv">158</span>   <span class="fl">435.56</span></a>
<a class="sourceLine" id="cb25-12" title="12">   int_<span class="dv">1</span> <span class="fl">10.00</span>  <span class="fl">10.00</span> <span class="fl">10.00</span>  <span class="ot">NaN</span>     <span class="dv">0</span>     <span class="fl">0.00</span></a>
<a class="sourceLine" id="cb25-13" title="13">   int_<span class="dv">2</span>  <span class="fl">9.05</span> <span class="fl">-14.75</span> <span class="fl">25.64</span> <span class="fl">1.08</span>    <span class="dv">52</span> <span class="fl">17563.26</span></a>
<a class="sourceLine" id="cb25-14" title="14"> sigma_<span class="dv">1</span> <span class="fl">11.01</span>   <span class="fl">9.52</span> <span class="fl">12.69</span> <span class="fl">1.00</span>  <span class="dv">2620</span>     <span class="fl">1.83</span></a>
<a class="sourceLine" id="cb25-15" title="15">     x_<span class="dv">1</span>  <span class="fl">1.56</span>   <span class="fl">1.22</span>  <span class="fl">1.88</span> <span class="fl">1.11</span>    <span class="dv">49</span>     <span class="fl">4.60</span></a>
<a class="sourceLine" id="cb25-16" title="16">     x_<span class="dv">2</span> <span class="fl">-3.29</span>  <span class="fl">-3.67</span> <span class="fl">-2.90</span> <span class="fl">1.10</span>   <span class="dv">118</span>     <span class="fl">2.43</span></a>
<a class="sourceLine" id="cb25-17" title="17">     x_<span class="dv">3</span>  <span class="fl">1.56</span>   <span class="fl">1.22</span>  <span class="fl">1.88</span> <span class="fl">1.11</span>    <span class="dv">49</span>     <span class="fl">4.60</span></a></code></pre></div>
</div>
</div>
<div id="do-much-more" class="section level1">
<h1 class="hasAnchor">
<a href="#do-much-more" class="anchor"></a>Do much more</h1>
<p>Don’t be constrained by these simple <code>mcp</code> functions. <code>fit$samples</code> is a regular <code>mcmc.list</code> object and all methods apply. You can work with the MCMC samples just as you would with <code>brms</code>, <code>rstanarm</code>, <code>jags</code>, or other samplers using the always excellent <code>tidybayes</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidybayes)</a>
<a class="sourceLine" id="cb26-2" title="2"></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="co"># Extract all parameters:</span></a>
<a class="sourceLine" id="cb26-4" title="4"><span class="kw">tidy_draws</span>(fit<span class="op">$</span>samples) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-5" title="5"><span class="st">  </span><span class="co"># tidybayes stuff here</span></a>
<a class="sourceLine" id="cb26-6" title="6"></a>
<a class="sourceLine" id="cb26-7" title="7"><span class="co"># Extract some parameters:</span></a>
<a class="sourceLine" id="cb26-8" title="8">fit<span class="op">$</span>pars<span class="op">$</span>model  <span class="co"># check out which parameters are inferred.</span></a>
<a class="sourceLine" id="cb26-9" title="9"><span class="kw">spread_draws</span>(fit<span class="op">$</span>samples, cp_<span class="dv">1</span>, cp_<span class="dv">2</span>, int_<span class="dv">1</span>, year_<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-10" title="10"><span class="st"> </span><span class="co"># tidybayes stuff here</span></a></code></pre></div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/lindeloev/mcp">https://​github.com/​lindeloev/​mcp</a>
</li>
<li>Report a bug at <br><a href="https://github.com/lindeloev/mcp/issues">https://​github.com/​lindeloev/​mcp/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4565-0595" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID"></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/lindeloev/mcp"><img src="https://travis-ci.org/lindeloev/mcp.svg?branch=master" alt="Travis-CI status"></a></li>
<li><a href="https://coveralls.io/r/lindeloev/mcp"><img src="https://codecov.io/gh/lindeloev/mcp/branch/master/graph/badge.svg" alt="Coveralls status"></a></li>
<li><a href="https://CRAN.R-project.org/package=mcp"><img src="https://www.r-pkg.org/badges/version/mcp" alt="CRAN status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

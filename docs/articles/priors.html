<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with priors in mcp • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Working with priors in mcp">
<meta property="og:description" content="">
<meta property="og:image" content="https://lindeloev.github.io/mcp/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with priors in mcp</h1>
                        <h4 class="author">Jonas Kristoffer Lindeløv</h4>
            
            <h4 class="date">2020-01-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindeloev/mcp/blob/master/vignettes/priors.Rmd"><code>vignettes/priors.Rmd</code></a></small>
      <div class="hidden name"><code>priors.Rmd</code></div>

    </div>

    
    
<div id="setting-a-prior" class="section level1">
<h1 class="hasAnchor">
<a href="#setting-a-prior" class="anchor"></a>Setting a prior</h1>
<p><code>mcp</code> takes priors in the form of a named list. The names are the parameter names, and the values are JAGS code. Here is a fairly complicated example, just to get enough priors to demonstrate the various ways priors can be used:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">model =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-2" title="2">  y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x,  <span class="co"># int_1 + x_1</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x,  <span class="co"># cp_1, int_2, and x_2</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x  <span class="co"># cp_2</span></a>
<a class="sourceLine" id="cb1-5" title="5">)</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7">prior =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="dt">int_1 =</span> <span class="st">"dnorm(0, 5) T(, 10)"</span>,  <span class="co"># Intercept; less than 10</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="dt">x_1 =</span> <span class="st">"dbeta(2, 5)"</span>,  <span class="co"># slope: beta with right skew</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="dt">cp_1 =</span> <span class="st">"dunif(MINX, cp_2)"</span>,  <span class="co"># change point between smallest x and cp_2</span></a>
<a class="sourceLine" id="cb1-11" title="11">  <span class="dt">x_2 =</span> <span class="st">"dt(0, 1, 3) T(x_1, )"</span>,  <span class="co"># slope 2 &gt; slope 1 and t-distributed</span></a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="dt">cp_2 =</span> <span class="dv">80</span>,  <span class="co"># A constant (set; not estimated)</span></a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="dt">x_3 =</span> <span class="st">"x_2"</span>  <span class="co"># continue same slope</span></a>
<a class="sourceLine" id="cb1-14" title="14">  <span class="co"># int_2 and int_3 not specified. Use default.</span></a>
<a class="sourceLine" id="cb1-15" title="15">)</a></code></pre></div>
<p>The values are JAGS code, so all JAGS distributions are allowed. These also include <code>gamma</code>, <code>dt</code>, <code>cauchy</code>, and many others. See the <a href="https://web.sgh.waw.pl/~atoroj/ekonometria_bayesowska/jags_user_manual.pdf">JAGS user manual</a> for more details. The parameterization of the distributions are identical to standard R. Use SD when you specify priors for <code>dnorm</code>, <code>dt</code>, <code>dlogis</code>, etc. <code>mcp</code> converts to precision for JAGS under the hood via the <code><a href="../reference/sd_to_prec.html">sd_to_prec()</a></code> function (<code>prec = 1 / sd^2</code>), so you don’t have to worry about it. You can see the effects of this conversion by inspecting the difference between <code>fit$prior</code> (using SD) and <code>fit$jags_code</code> (using precision).</p>
<p>Other notes:</p>
<ul>
<li><p>Order restriction is automatically applied to change points (<code>cp_*</code> parameters) using truncation (e.g., <code><a href="https://rdrr.io/r/base/logical.html">T(cp_1, )</a></code>) so that they are in the correct order on the x-axis. You can override this behavior by defining <code><a href="https://rdrr.io/r/base/logical.html">T()</a></code> or <code>dunif</code> yourself (<code>dunif</code> is inherently truncated), in which case <code>mcp</code> won’t do further. Dirichlet priors are inherently ordered (<a href="#cp_prior">jump to section</a>) and cannot be further truncated.</p></li>
<li><p>In addition to the model parameters, <code>MINX</code> (minimum x-value), <code>MAXX</code> (maximum x-value), <code>SDX</code>, <code>MEANX</code>, <code>MINY</code>, <code>MAXY</code>, <code>MEANY</code>, and <code>SDY</code> are also available when you set priors. They are used to set uninformative default priors. Strictly speaking, this is “illegal”, but it does ensure that estimation works reasonably across many orders of magnitude.</p></li>
<li><p>You can fix any parameter to a specific value. Simply set it to a numerical value (as <code>cp_2</code> above). A constant is a 100% prior belief in that value, and it will therefore not be estimated.</p></li>
<li><p>You can also equate one variable with another (<code>x_3 = "x_2"</code> above). You would usually do this to share parameters across segments, but you can be creative and do something like <code>x_3 = "x_2 + 5 - cp_1/10"</code> if you want. In any case, it will lead to one less parameter being estimated, i.e., one less free parameter.</p></li>
</ul>
<p>Let us see the priors after running them through <code>mcp</code> and compare to the default priors:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mcp)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">mc.cores =</span> <span class="dv">3</span>)  <span class="co"># Speed up sampling!</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">empty_manual =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">prior =</span> prior, <span class="dt">sample =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">empty_default =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">sample =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co"># Look at fit$prior and show them side-by-side</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">manual =</span> empty_manual<span class="op">$</span>prior, <span class="dt">default =</span> empty_default<span class="op">$</span>prior)</a></code></pre></div>
<pre><code>##         manual                
## cp_1    "dunif(MINX, cp_2)"   
## cp_2    80                    
## int_1   "dnorm(0, 5) T(, 10)" 
## int_2   "dt(0, 3 * SDY, 3)"   
## int_3   "dt(0, 3 * SDY, 3)"   
## x_1     "dbeta(2, 5)"         
## x_2     "dt(0, 1, 3) T(x_1, )"
## x_3     "x_2"                 
## sigma_1 "dnorm(0, SDY) T(0, )"
##         default                                                 
## cp_1    "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_0, MAXX)"
## cp_2    "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_1, MAXX)"
## int_1   "dt(0, 3 * SDY, 3)"                                     
## int_2   "dt(0, 3 * SDY, 3)"                                     
## int_3   "dt(0, 3 * SDY, 3)"                                     
## x_1     "dt(0, SDY / (MAXX - MINX), 3)"                         
## x_2     "dt(0, SDY / (MAXX - MINX), 3)"                         
## x_3     "dt(0, SDY / (MAXX - MINX), 3)"                         
## sigma_1 "dnorm(0, SDY) T(0, )"</code></pre>
<p>Now, let’s simulate some data that from the <code>model</code>. The following priors are “at odds” with the actual data so as to show their effect.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">df =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">100</span>))  <span class="co"># 200 datapoints between 0 and 100</span></a>
<a class="sourceLine" id="cb4-2" title="2">df<span class="op">$</span>y =<span class="st"> </span>empty_default<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(df<span class="op">$</span>x, </a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">int_1 =</span> <span class="dv">20</span>, <span class="dt">int_2 =</span> <span class="dv">30</span>, <span class="dt">int_3 =</span> <span class="dv">30</span>,  <span class="co"># intercepts</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">x_1 =</span> <span class="fl">-0.5</span>, <span class="dt">x_2 =</span> <span class="fl">0.5</span>, <span class="dt">x_3 =</span> <span class="dv">0</span>,  <span class="co"># slopes</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">cp_1 =</span> <span class="dv">35</span>, <span class="dt">cp_2 =</span> <span class="dv">70</span>,  <span class="co"># change points</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">sigma =</span> <span class="dv">5</span>)</a></code></pre></div>
<p>Sample the prior and posterior. We let the manual fit adapt for longer, since it is harder to find the right posterior under these weird prior constraints (priors will usually improve sampling efficiency).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">fit_manual =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, prior, <span class="dt">sample =</span> <span class="st">"both"</span>, <span class="dt">adapt =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">fit_default =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, <span class="dt">sample =</span> <span class="st">"both"</span>, <span class="dt">adapt =</span> <span class="dv">10000</span>)</a></code></pre></div>
<p>First, let’s look at the priors side by side. Notice the use of <code>prior = TRUE</code> to show prior samples. This works in <code><a href="../reference/plot.mcpfit.html">plot()</a></code>, <code><a href="../reference/plot_pars.html">plot_pars()</a></code>, and <code><a href="../reference/summary.mcpfit.html">summary()</a></code> among others.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb6-2" title="2">pp_default =<span class="st"> </span><span class="kw"><a href="../reference/plot_pars.html">plot_pars</a></span>(fit_default, <span class="dt">type =</span> <span class="st">"dens_overlay"</span>, <span class="dt">prior =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Default priors"</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">pp_manual =<span class="st"> </span><span class="kw"><a href="../reference/plot_pars.html">plot_pars</a></span>(fit_manual, <span class="dt">type =</span> <span class="st">"dens_overlay"</span>, <span class="dt">prior =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Manual priors"</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">pp_default <span class="op">+</span><span class="st"> </span>pp_manual</a></code></pre></div>
<p><img src="priors_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Here is the resulting posterior fits:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">plot_default =<span class="st"> </span><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_default) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Default priors"</span>)</a>
<a class="sourceLine" id="cb7-2" title="2">plot_manual =<span class="st"> </span><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_manual) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Manual priors"</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">plot_default <span class="op">+</span><span class="st"> </span>plot_manual</a></code></pre></div>
<p><img src="priors_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We see the effects of the priors.</p>
<ul>
<li>The intercept <code>int_1</code> was truncated to be below 10.</li>
<li>The slope <code>x_1</code> is bound to be non-negative (because <code>dbeta</code>).</li>
<li>The slopes <code>x_2</code> and <code>x_3</code> were forced to be identical.</li>
<li>The change point <code>cp_2</code> was a constant, so there is no uncertainty there.</li>
</ul>
<p>Of course, it will usually be the other way around: setting priors manually will often serve to sample the “correct” posterior.</p>
</div>
<div id="cp_prior" class="section level1">
<h1 class="hasAnchor">
<a href="#cp_prior" class="anchor"></a>Default priors on change points</h1>
<p>Change points have to be ordered from left (<code>cp_1</code>) to right (<code>cp_2+</code>). This order restriction is enforced through the priors and this is not trival. <code>mcp</code> currently offers two “packages” of change point priors that achieves different goals:</p>
<ul>
<li><p><strong>Speed and estimation:</strong> The default prior is suitable for estimation, prediction, and it works well for <code><a href="../reference/criterion.html">loo()</a></code> cross-validation as well. It’s main virtue is that it samples the change point posteriors relatively effectively, but it will often be deeply unfit for Bayes Factors if there are 3+ change points (see below). It may also favor “late” change points too much if estimating many change points with little data (e.g. 5 change points with 100 data points or 10 with 300).</p></li>
<li><p><strong>Uninformative and nice mathematical properties:</strong> Use the <code>Dirichlet</code> prior if you want a more uninformative prior that is better suited for <em>everything</em> including Bayes Factors, scientific publication, or even estimation at 6+ change points. It has better known mathematical properties and a precedence in <a href="https://psyarxiv.com/9qkhj/">Büerkner &amp; Charpentier (2019)</a>. It is not default because it often samples order(s) of magnitude less efficiently than the default priors while yielding identical fits. In these cases you need to increase the number of MCMC samples (e.g. <code><a href="../reference/mcp.html">mcp(..., iter = 20000)</a></code>).</p></li>
</ul>
<p>They two “packages” are identical for one change point, though the default still samples more effectively.</p>
<p><img src="priors_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div id="the-t-tail-prior-on-2-change-points-default" class="section level2">
<h2 class="hasAnchor">
<a href="#the-t-tail-prior-on-2-change-points-default" class="anchor"></a>The t-tail prior on 2+ change points (default)</h2>
<p><em>OBS: These priors are likely to change in versions beyond mcp 0.2, but not drastically.</em></p>
<p>The first change point defaults to <code>cp_1 = dunif(MINX, MAXX)</code>. In other words, the change point has to happen in the observed range of x, but it is equally probable across this range. This is identical to the Dirichlet prior.</p>
<p>For 2+ change points, the default (on <em>all</em> change points) is <code>cp_i = dt(MINX, (MAXX-MINX) / N_CP, N_CP - 1) T(cp_i-1, MAXX)</code>. This is not as complicated as it looks, so let me unpack it.</p>
<ul>
<li>It is t-distributed with <span class="math inline">\(N - 1\)</span> degree of freedom (<code><a href="https://rdrr.io/r/stats/TDist.html">dt(..., N_CP - 1)</a></code>). This ensures narrower priors as the number of change points increase, so as to avoid excessive accumulation of densities at high <span class="math inline">\(x\)</span>.</li>
<li>It is truncated to be greater than the previous <code>cp</code>. For example, <code>cp_3 = dt(...) T(cp_2, MAXX)</code>. Since <code>cp_0 = MINX</code>, all change points are “forced” to be in the observed range of <code>x</code>.</li>
<li>The standard deviation is the distance between equally-spaced change points: <code>(MAXX - MINX) / N_CP</code>.</li>
<li>The mean is always the lowest observed <code>x</code>. Thus <code>cp_1</code> is a half-t and <code>cp_2+</code> are right tails of the same t. Hence the name “t-tail prior”. Since they are estimated using MCMC, the fact that the <em>absolute</em> densities are smaller for later change points is of no importance since only the <em>relative</em> densities matter.</li>
</ul>
<p>One side effect of the truncation is that later change points have greater prior probability density towards the right side of the x-axis. In practice, this “bias” is so weak that it takes a combination of many change points and few data for it to impact the posterior in any noticeable way.</p>
</div>
<div id="dirichlet-based-prior-on-change-points" class="section level2">
<h2 class="hasAnchor">
<a href="#dirichlet-based-prior-on-change-points" class="anchor"></a>Dirichlet-based prior on change points</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Dirichlet_distribution">Dirichlet distribution</a> is a multivariate beta prior and these betas jointly form a simplex, meaning that they are all positive and sum to one. They are all in the interval <span class="math inline">\([0, 1]\)</span> so they are shifted and scaled to <span class="math inline">\([min(x), max(x)]\)</span>. The Dirichlet prior has the nice property that (1) the order-restriction and boundedness is inherent to the distribution, and (2) it represents a uniform prior that <em>any</em> change happens at any <span class="math inline">\(x\)</span>, i.e., it is maximally uninformative. It underlies the modeling of monotonic effects in brms (<a href="https://psyarxiv.com/9qkhj/">Büerkner &amp; Charpentier (2019)</a>).</p>
<p>To use the Dirichlet prior, you need to specify it for all or none of the change points. E.g.,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">prior_dirichlet =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">cp_1 =</span> <span class="st">"dirichlet(1)"</span>,</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">cp_2 =</span> <span class="st">"dirichlet(1)"</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="dt">cp_3 =</span> <span class="st">"dirichlet(1)"</span></a>
<a class="sourceLine" id="cb8-5" title="5">)</a></code></pre></div>
<p>The number in the parenthesis is the <span class="math inline">\(\alpha\)</span> parameter, so you could also specify <code>cp_1 = "dirichlet(3)</code> if you want to push credence for that and later change points more to the rightwards while pushing earlier priors leftwards.</p>
</div>
<div id="manual-priors-on-change-points" class="section level2">
<h2 class="hasAnchor">
<a href="#manual-priors-on-change-points" class="anchor"></a>Manual priors on change points</h2>
<p>You can easily change or modify change point priors, just as we did in the initial example. But beware that the nature of the priors change when truncation is applied. Use <code><a href="../reference/plot_pars.html">plot_pars(fit, prior = TRUE)</a></code> to check the resulting prior.</p>
<p>If you want more informed priors on the change point location, i.e., <code>cp_2 = "dnorm(40, 10)</code>, <code>mcp</code> adds this order restriction by adding <code>cp_2 = "dnorm(40, 10) T(cp_1, MAXX)</code>. You can avoid this behavior by explicitly doing an “empty” truncation yourself, e.g., <code>cp_2 = "dnorm(40, 10) T(,)</code>. However, the model may fail to sample the correct posterior in samples where order restriction is not kept.</p>
</div>
</div>
<div id="default-priors-on-linear-predictors" class="section level1">
<h1 class="hasAnchor">
<a href="#default-priors-on-linear-predictors" class="anchor"></a>Default priors on linear predictors</h1>
<p><em>OBS: These priors are very to change in versions beyond mcp 0.2, but not drastically.</em></p>
<p>You can see the default priors for the <code><a href="https://rdrr.io/r/stats/family.html">gaussian()</a></code> family in the previous example. They are similar to the <code>brms</code> default priors, i.e., t-distributed around mean = 0 with a standard deviation that scales with the data.</p>
<p>This means that there will be some “shrinkage” towards a mean and SD of zero for all parameters, especially for parameters with a large mean and a small SD.</p>
<p>The slopes are scaled as if it changed +/- 1 SD through the entire x-axis. This too will be insufficient for very steep slopes, i.e., if there are many change points on <code>x</code>.</p>
<p>See the family-specific articles for more information about the priors for other families:</p>
<ul>
<li>
<code><a href="../articles/binomial.html">vignette("binomial")</a></code> - also relevant for <code>bernoulli</code>
</li>
<li><code><a href="../articles/poisson.html">vignette("poisson")</a></code></li>
</ul>
</div>
<div id="default-priors-on-varying-effects" class="section level1">
<h1 class="hasAnchor">
<a href="#default-priors-on-varying-effects" class="anchor"></a>Default priors on varying effects</h1>
<p>See <a href="https://lindeloev.github.io/mcp/articles/varying.html">varying change points with mcp</a>.</p>
</div>
<div id="prior-predictive-checks" class="section level1">
<h1 class="hasAnchor">
<a href="#prior-predictive-checks" class="anchor"></a>Prior predictive checks</h1>
<p>Prior predictive checks is a great way to ensure that the priors are meaningful. Simply set <code>sample = "prior"</code>. Let us do it for the two sets of priors defined previously in this article, to see their different prior predictive space.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Sample priors </span></a>
<a class="sourceLine" id="cb9-2" title="2">fit_pp_manual =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, prior, <span class="dt">sample =</span> <span class="st">"prior"</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">fit_pp_default =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, <span class="dt">sample =</span> <span class="st">"prior"</span>)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co"># Plot it</span></a>
<a class="sourceLine" id="cb9-6" title="6">plot_pp_manual =<span class="st"> </span><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_pp_manual, <span class="dt">lines =</span> <span class="dv">100</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">400</span>, <span class="dv">400</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Manual prior"</span>)</a>
<a class="sourceLine" id="cb9-7" title="7">plot_pp_default =<span class="st"> </span><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_pp_default, <span class="dt">lines =</span> <span class="dv">100</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">400</span>, <span class="dv">400</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Default prior"</span>)</a>
<a class="sourceLine" id="cb9-8" title="8">plot_pp_manual <span class="op">+</span><span class="st">  </span>plot_pp_default  <span class="co"># using patchwork</span></a></code></pre></div>
<p><img src="priors_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>You can see how the manual priors are more dense to the left, and the “concerted” change at x = 80.</p>
</div>
<div id="jags-code" class="section level1">
<h1 class="hasAnchor">
<a href="#jags-code" class="anchor"></a>JAGS code</h1>
<p>Here is the JAGS code for <code>fit_manual</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(fit_manual<span class="op">$</span>jags_code)</a></code></pre></div>
<pre><code>## 
## model {
## 
##   # Priors for population-level effects
##   cp_0 = MINX  # mcp helper value.
##   cp_3 = MAXX  # mcp helper value.
## 
##   cp_1 ~ dunif(MINX, cp_2)
##   cp_2 = 80  # Fixed
##   int_1 ~ dnorm(0, 1/(5)^2) T(, 10)
##   int_2 ~ dt(0, 1/(3*SDY)^2, 3) 
##   int_3 ~ dt(0, 1/(3*SDY)^2, 3) 
##   x_1 ~ dbeta(2, 5)
##   x_2 ~ dt(0, 1/(1)^2, 3) T(x_1, )
##   x_3 = x_2  # Fixed
##   sigma_1 ~ dnorm(0, 1/(SDY)^2) T(0, )
## 
## 
##   # Model and likelihood
##   for (i_ in 1:length(x)) {
##     X_1_[i_] = min(x[i_], cp_1)
##     X_2_[i_] = min(x[i_], cp_2) - cp_1
##     X_3_[i_] = min(x[i_], cp_3) - cp_2
##     
##     # Fitted value
##     y_[i_] = 
##     
##       # Segment 1: y ~ 1 + x
##       (x[i_] &gt;= cp_0) * (x[i_] &lt; cp_1) * int_1 + 
##       (x[i_] &gt;= cp_0) * (x[i_] &lt; cp_1) * x_1 * X_1_[i_] + 
##     
##       # Segment 2: y ~ 1 ~ 1 + x
##       (x[i_] &gt;= cp_1) * (x[i_] &lt; cp_2) * int_2 + 
##       (x[i_] &gt;= cp_1) * (x[i_] &lt; cp_2) * x_2 * X_2_[i_] + 
##     
##       # Segment 3: y ~ 1 ~ 1 + x
##       (x[i_] &gt;= cp_2) * int_3 + 
##       (x[i_] &gt;= cp_2) * x_3 * X_3_[i_] 
##     
##     # Fitted standard deviation
##     sigma_[i_] = 
##       (x[i_] &gt;= cp_0) * sigma_1 
## 
##     # Likelihood and log-density for family = gaussian()
##     y[i_] ~ dnorm((y_[i_]), 1 / sigma_[i_]^2)
##     loglik_[i_] = logdensity.norm(y[i_], (y_[i_]), 1 / sigma_[i_]^2)
##   }
## }</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setting-a-prior">Setting a prior</a></li>
      <li>
<a href="#cp_prior">Default priors on change points</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-t-tail-prior-on-2-change-points-default">The t-tail prior on 2+ change points (default)</a></li>
      <li><a href="#dirichlet-based-prior-on-change-points">Dirichlet-based prior on change points</a></li>
      <li><a href="#manual-priors-on-change-points">Manual priors on change points</a></li>
      </ul>
</li>
      <li><a href="#default-priors-on-linear-predictors">Default priors on linear predictors</a></li>
      <li><a href="#default-priors-on-varying-effects">Default priors on varying effects</a></li>
      <li><a href="#prior-predictive-checks">Prior predictive checks</a></li>
      <li><a href="#jags-code">JAGS code</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

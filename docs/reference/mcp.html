<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit Multiple Linear Segments And Their Change Points — mcp • mcp</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Fit Multiple Linear Segments And Their Change Points — mcp" />
<meta property="og:description" content="Given a list of linear segments, mcp infers the posterior
distributions of the parameters of each segment as well as the change points
between segments. See more details and worked examples on the mcp website.
All segments must regress on the same x-variable. Change
points are forced to be ordered using truncation of the priors. You can run
fit = mcp(segments, sample=FALSE) to avoid sampling and the need for
data if you just want to get the priors (fit$prior), the JAGS code
fit$jags_code, or the R function to simulate data (fit$simulate)." />
<meta property="og:image" content="https://lindeloev.github.io/mcp/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Multiple Linear Segments And Their Change Points</h1>
    <small class="dont-index">Source: <a href='https://github.com/lindeloev/mcp/blob/master/R/mcp.R'><code>R/mcp.R</code></a></small>
    <div class="hidden name"><code>mcp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a list of linear segments, <code>mcp</code> infers the posterior
distributions of the parameters of each segment as well as the change points
between segments. <a href='https://lindeloev.github.io/mcp/'>See more details and worked examples on the mcp website</a>.
All segments must regress on the same x-variable. Change
points are forced to be ordered using truncation of the priors. You can run
<code>fit = mcp(segments, sample=FALSE)</code> to avoid sampling and the need for
data if you just want to get the priors (<code>fit$prior</code>), the JAGS code
<code>fit$jags_code</code>, or the R function to simulate data (<code>fit$simulate</code>).</p>
    </div>

    <pre class="usage"><span class='fu'>mcp</span>(
  <span class='no'>segments</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span>(),
  <span class='kw'>par_x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sample</span> <span class='kw'>=</span> <span class='st'>"post"</span>,
  <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>3000</span>,
  <span class='kw'>adapt</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>inits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>jags_code</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>segments</th>
      <td><p>A list of formulas - one for each segment. The first formula
has the format <code>response ~ predictors</code> while the following formulas
have the format <code>response ~ changepoint ~ predictors</code>. The response
and change points can be omitted (<code>changepoint ~ predictors</code> assumes same
response. <code>~ predictors</code> assumes an intercept-only change point). Segments
can model</p><ul>
<li><p><em>Regular formulas:</em> e.g., <code>~ 1 + x</code>). <a href='https://lindeloev.github.io/mcp/articles/formulas.html'>Read more</a>.</p></li>
<li><p><em>Extended formulas:</em>, e.g., <code>~ I(x^2) + exp(x) + sin(x)</code>. <a href='https://lindeloev.github.io/mcp/articles/formulas.html'>Read more</a>.</p></li>
<li><p><em>Variance:</em> e.g., <code>~sigma(1)</code> for a simple variance change or
<code>~sigma(rel(1) + I(x^2))</code>) for more advanced variance structures. <a href='https://lindeloev.github.io/mcp/articles/variance.html'>Read more</a></p></li>
<li><p><em>Autoregression:</em> e.g., <code>~ar(1)</code> for a simple onset/change in AR(1) or
<code>ar(2, 0 + x</code>) for an AR(2) increasing by <code>x</code>. <a href='https://lindeloev.github.io/mcp/articles/arma.html'>Read more</a></p></li>
</ul></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>Data.frame or tibble in long format.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>Named list. Names are parameter names (<code>cp_i</code>, <code>int_i</code>, <code>xvar_i</code>,
`sigma``) and the values are either</p><ul>
<li><p>A JAGS distribution (e.g., <code>int_1 = "dnorm(0, 1) T(0,)"</code>) indicating a
conventional prior distribution. Uninformative priors based on data
properties are used where priors are not specified. This ensures good
parameter estimations, but it is a questionable for hypothesis testing.
<code>mcp</code> uses SD (not precision) for dnorm, dt, dlogis, etc. See
details. Change points are forced to be ordered through the priors using
truncation, except for uniform priors where the lower bound should be
greater than the previous change point, <code><a href='https://rdrr.io/r/stats/Uniform.html'>dunif(cp_1, MAXX)</a></code>.</p></li>
<li><p>A numerical value (e.g., <code>int_1 = -2.1</code>) indicating a fixed value.</p></li>
<li><p>A model parameter name (e.g., <code>int_2 = "int_1"</code>), indicating that this parameter is shared -
typically between segments. If two varying effects are shared this way,
they will need to have the same grouping variable.</p></li>
<li><p>A scaled Dirichlet prior is supported for change points if they are all set to
<code>cp_i = "dirichlet(N)</code> where <code>N</code> is the alpha for this change point and
<code>N = 1</code> is most often used. This prior is less informative about the
location of the change points than the default uniform prior, but it
samples less efficiently, so you will often need to set <code>iter</code> higher.
It is recommended for hypothesis testing and for the estimation of more
than 5 change points. <a href='https://lindeloev.github.io/mcp/articles/priors.html'>Read more</a>.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>One of <code><a href='https://rdrr.io/r/stats/family.html'>gaussian()</a></code>, <code><a href='https://rdrr.io/r/stats/family.html'>binomial()</a></code>, <code><a href='bernoulli.html'>bernoulli()</a></code>, or <code>poission()</code>.
Only default link functions are currently supported.</p></td>
    </tr>
    <tr>
      <th>par_x</th>
      <td><p>String (default: NULL). Only relevant if no segments contains
slope (no hint at what x is). Set this, e.g., par_x = "time".</p></td>
    </tr>
    <tr>
      <th>sample</th>
      <td><p>One of</p><ul>
<li><p><code>"post"</code> (default): Sample the posterior.</p></li>
<li><p><code>"prior"</code>: Sample only the prior. Plots, summaries, etc. will
use the prior. This is useful for prior predictive checks.</p></li>
<li><p><code>"both"</code>: Sample both prior and posterior. Plots, summaries, etc.
will default to using the posterior. The prior only has effect when doing
Savage-Dickey density ratios in <code><a href='hypothesis.html'>hypothesis</a></code>.</p></li>
<li><p><code>"none"</code> or <code>FALSE</code>: Do not sample. Returns an mcpfit
object without sample. This is useful if you only want to check
prior strings (fit$prior), the JAGS model (fit$jags_code), etc.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Positive integer or "all". Number of cores.</p><ul>
<li><p><code>1</code>: serial sampling</p></li>
<li><p><code>&gt;1</code>: parallel sampling on this number of cores. Ideally set <code>chains</code>
to the same value. Note: <code>cores &gt; 1</code> takes a few extra seconds the first
time it's called but subsequent calls will start sampling immediately.</p></li>
<li><p><code>"all"</code>: use all cores but one and sets <code>chains</code> to the same value. This is
a convenient way to maximally use your computer's power.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>Positive integer. Number of chains to run.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>Positive integer. Number of post-warmup samples to draw.</p></td>
    </tr>
    <tr>
      <th>adapt</th>
      <td><p>Positive integer. Also sometimes called "burnin", this is the
number of samples used to reach convergence. Set lower for greater speed.
Set higher if the chains haven't converged yet or look at <a href='https://lindeloev.github.io/mcp/articles/tips.html'>tips, tricks, and debugging</a>.</p></td>
    </tr>
    <tr>
      <th>inits</th>
      <td><p>A list if initial values for the parameters. This can be useful
if a model fails to converge. Read more in <code><a href='https://rdrr.io/pkg/rjags/man/jags.model.html'>jags.model</a></code>.
Defaults to <code>NULL</code>, i.e., no inits.</p></td>
    </tr>
    <tr>
      <th>jags_code</th>
      <td><p>Pass JAGS code to <code>mcp</code> to use directly. This is useful if
you want to tweak the code in <code>fit$jags_code</code> and run it within the <code>mcp</code>
framework.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code><a href='mcpfit-class.html'>mcpfit</a></code> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Notes on priors:</p><ul>
<li><p>Order restriction is automatically applied to cp_\* parameters using
truncation (e.g., <code><a href='https://rdrr.io/r/base/logical.html'>T(cp_1, )</a></code>) so that they are in the correct order on the
x-axis UNLESS you do it yourself. The one exception is for dunif
distributions where you have to do it as above.</p></li>
<li><p>In addition to the model parameters, <code>MINX</code> (minimum x-value), <code>MAXX</code>
(maximum x-value), <code>SDX</code> (etc...), <code>MINY</code>, <code>MAXY</code>, and <code>SDY</code>
are also available when you set priors. They are used to set uninformative
default priors.</p></li>
<li><p>Use SD when you specify priors for dt, dlogis, etc. JAGS uses precision
but <code>mcp</code> converts to precision under the hood via the sd_to_prec()
function. So you will see SDs in <code>fit$prior</code> but precision ($1/SD^2)
in <code>fit$jags_code</code></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='get_segment_table.html'>get_segment_table</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Define the segments using formulas. A change point is estimated between each formula.</span>
<span class='no'>segments</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='no'>response</span> ~ <span class='fl'>1</span>,  <span class='co'># Plateau in the first segment (int_1)</span>
  ~ <span class='fl'>0</span> + <span class='no'>time</span>,    <span class='co'># Joined slope (time_2) at cp_1</span>
  ~ <span class='fl'>1</span> + <span class='no'>time</span>     <span class='co'># Disjoined slope (int_3, time_3) at cp_2</span>
)

<span class='co'># Fit it. The `ex_demo` dataset is included in mcp. Sample the prior too.</span>
<span class='co'># options(mc.cores = 3)  # Uncomment to speed up sampling</span>
<span class='no'>ex_fit</span> <span class='kw'>=</span> <span class='fu'>mcp</span>(<span class='no'>segments</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>ex_demo</span>, <span class='kw'>sample</span> <span class='kw'>=</span> <span class='st'>"both"</span>)</div><div class='output co'>#&gt; Compiling model graph
#&gt;    Resolving undeclared variables
#&gt;    Allocating nodes
#&gt; Graph information:
#&gt;    Observed stochastic nodes: 100
#&gt;    Unobserved stochastic nodes: 7
#&gt;    Total graph size: 1730
#&gt; 
#&gt; Initializing model
#&gt; </div><div class='output co'>#&gt; <span class='message'>Finished sampling in 8.1 seconds</span></div><div class='output co'>#&gt; Compiling model graph
#&gt;    Resolving undeclared variables
#&gt;    Allocating nodes
#&gt; Graph information:
#&gt;    Observed stochastic nodes: 0
#&gt;    Unobserved stochastic nodes: 107
#&gt;    Total graph size: 1730
#&gt; 
#&gt; Initializing model
#&gt; </div><div class='output co'>#&gt; <span class='message'>Finished sampling in 0.1 seconds</span></div><div class='input'><span class='co'># }</span>

<span class='co'># See parameter estimates</span>
<span class='fu'><a href='summary.mcpfit.html'>summary</a></span>(<span class='no'>ex_fit</span>)</div><div class='output co'>#&gt; Family: gaussian(link = 'identity')
#&gt; Iterations: 9000 from 3 chains.
#&gt; Segments:
#&gt;   1: response ~ 1
#&gt;   2: response ~ 1 ~ 0 + time
#&gt;   3: response ~ 1 ~ 1 + time
#&gt; 
#&gt; Population-level parameters:
#&gt;     name match  sim  mean lower  upper Rhat n.eff   ts_se
#&gt;     cp_1    OK 30.0 30.72 22.85 38.051    1   371 366.487
#&gt;     cp_2    OK 70.0 69.77 69.27 70.232    1  5918   0.129
#&gt;    int_1    OK 10.0 10.32  8.92 11.724    1  1630   2.621
#&gt;    int_3    OK  0.0  0.50 -2.40  3.637    1   747  28.905
#&gt;  sigma_1    OK  4.0  4.01  3.45  4.621    1  4373   0.184
#&gt;   time_2    OK  0.5  0.54  0.41  0.673    1   381   0.117
#&gt;   time_3    OK -0.2 -0.22 -0.40 -0.045    1   762   0.098</div><div class='input'>
<span class='co'># Visual inspection of the results</span>
<span class='fu'><a href='plot.mcpfit.html'>plot</a></span>(<span class='no'>ex_fit</span>)</div><div class='img'><img src='mcp-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='plot_pars.html'>plot_pars</a></span>(<span class='no'>ex_fit</span>)</div><div class='img'><img src='mcp-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Test a hypothesis</span>
<span class='fu'><a href='hypothesis.html'>hypothesis</a></span>(<span class='no'>ex_fit</span>, <span class='st'>"cp_1 &gt; 10"</span>)</div><div class='output co'>#&gt;      hypothesis     mean   lower   upper p  BF
#&gt; 1 cp_1 - 10 &gt; 0 20.71633 12.8479 28.0509 1 Inf</div><div class='input'>
<span class='co'># \donttest{</span>
<span class='co'># Compare to a one-intercept-only model (no change points) with default prior</span>
<span class='no'>segments_null</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>response</span> ~ <span class='fl'>1</span>)
<span class='no'>fit_null</span> <span class='kw'>=</span> <span class='fu'>mcp</span>(<span class='no'>segments_null</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>ex_demo</span>, <span class='kw'>par_x</span> <span class='kw'>=</span> <span class='st'>"time"</span>)  <span class='co'># fit another model here</span></div><div class='output co'>#&gt; Compiling model graph
#&gt;    Resolving undeclared variables
#&gt;    Allocating nodes
#&gt; Graph information:
#&gt;    Observed stochastic nodes: 100
#&gt;    Unobserved stochastic nodes: 2
#&gt;    Total graph size: 518
#&gt; 
#&gt; Initializing model
#&gt; </div><div class='output co'>#&gt; <span class='message'>Finished sampling in 1.6 seconds</span></div><div class='input'><span class='no'>ex_fit</span>$<span class='no'>loo</span> <span class='kw'>=</span> <span class='fu'><a href='criterion.html'>loo</a></span>(<span class='no'>ex_fit</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Some Pareto k diagnostic values are slightly high. See help('pareto-k-diagnostic') for details.</span></div><div class='input'><span class='no'>fit_null</span>$<span class='no'>loo</span> <span class='kw'>=</span> <span class='fu'><a href='criterion.html'>loo</a></span>(<span class='no'>fit_null</span>)
<span class='kw pkg'>loo</span><span class='kw ns'>::</span><span class='fu'><a href='https://mc-stan.org/loo/reference/loo_compare.html'>loo_compare</a></span>(<span class='no'>ex_fit</span>$<span class='no'>loo</span>, <span class='no'>fit_null</span>$<span class='no'>loo</span>)</div><div class='output co'>#&gt;        elpd_diff se_diff
#&gt; model1    0.0       0.0 
#&gt; model2 -108.0       8.8 </div><div class='input'><span class='co'># }</span>

<span class='co'># Inspect the prior. Useful for prior predictive checks.</span>
<span class='fu'><a href='summary.mcpfit.html'>summary</a></span>(<span class='no'>ex_fit</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; Family: gaussian(link = 'identity')
#&gt; Iterations: 9000 from 3 chains.
#&gt; Segments:
#&gt;   1: response ~ 1
#&gt;   2: response ~ 1 ~ 0 + time
#&gt;   3: response ~ 1 ~ 1 + time
#&gt; 
#&gt; Population-level parameters:
#&gt;     name match  sim    mean    lower  upper Rhat n.eff   ts_se
#&gt;     cp_1    OK 30.0 37.4995  3.2e+00  85.94    1  9000 6.2e+02
#&gt;     cp_2    OK 70.0 60.8963  2.0e+01  97.96    1  9000 5.6e+02
#&gt;    int_1    OK 10.0 -0.8966 -1.2e+02 117.88    1  9000 4.3e+03
#&gt;    int_3    OK  0.0  0.2968 -1.2e+02 112.56    1  9000 3.7e+03
#&gt;  sigma_1    OK  4.0  9.5164  5.4e-03  23.41    1  9000 5.3e+01
#&gt;   time_2        0.5 -0.0021 -3.9e-01   0.42    1  9000 4.3e-02
#&gt;   time_3    OK -0.2 -0.0013 -3.8e-01   0.43    1  9000 4.7e-02</div><div class='input'><span class='fu'><a href='plot.mcpfit.html'>plot</a></span>(<span class='no'>ex_fit</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='mcp-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Show all priors. Default priors are added where you don't provide any</span>
<span class='fu'><a href='summary.mcpfit.html'>print</a></span>(<span class='no'>ex_fit</span>$<span class='no'>prior</span>)</div><div class='output co'>#&gt; $cp_1
#&gt; [1] "dt(MINX, (MAXX - MINX) / N_CP, 1) T(cp_0, MAXX)"
#&gt; 
#&gt; $cp_2
#&gt; [1] "dt(MINX, (MAXX - MINX) / N_CP, 1) T(cp_1, MAXX)"
#&gt; 
#&gt; $int_1
#&gt; [1] "dt(0, 3 * SDY, 3)"
#&gt; 
#&gt; $int_3
#&gt; [1] "dt(0, 3 * SDY, 3)"
#&gt; 
#&gt; $time_2
#&gt; [1] "dt(0, SDY / (MAXX - MINX), 3)"
#&gt; 
#&gt; $time_3
#&gt; [1] "dt(0, SDY / (MAXX - MINX), 3)"
#&gt; 
#&gt; $sigma_1
#&gt; [1] "dnorm(0, SDY) T(0, )"
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "mcpprior"</div><div class='input'>
<span class='co'># Set priors and re-run</span>
<span class='no'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>int_1</span> <span class='kw'>=</span> <span class='fl'>15</span>,
  <span class='kw'>time_2</span> <span class='kw'>=</span> <span class='st'>"dt(0, 2, 1) T(0, )"</span>,  <span class='co'># t-dist slope. Truncated to positive.</span>
  <span class='kw'>cp_2</span> <span class='kw'>=</span> <span class='st'>"dunif(cp_1, 80)"</span>,    <span class='co'># change point to segment 2 &gt; cp_1 and &lt; 80.</span>
  <span class='kw'>int_3</span> <span class='kw'>=</span> <span class='st'>"int_1"</span>           <span class='co'># Shared intercept between segment 1 and 3</span>
)

<span class='co'># \donttest{</span>
<span class='no'>fit3</span> <span class='kw'>=</span> <span class='fu'>mcp</span>(<span class='no'>segments</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>ex_demo</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>prior</span>)</div><div class='output co'>#&gt; Compiling model graph
#&gt;    Resolving undeclared variables
#&gt;    Allocating nodes
#&gt; Graph information:
#&gt;    Observed stochastic nodes: 100
#&gt;    Unobserved stochastic nodes: 5
#&gt;    Total graph size: 1729
#&gt; 
#&gt; Initializing model
#&gt; </div><div class='output co'>#&gt; <span class='message'>Finished sampling in 6.4 seconds</span></div><div class='input'><span class='co'># }</span>

<span class='co'># Show the JAGS model</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='no'>ex_fit</span>$<span class='no'>jags_code</span>)</div><div class='output co'>#&gt; 
#&gt; model {
#&gt; 
#&gt;   # Priors for population-level effects
#&gt;   cp_0 = MINX  # mcp helper value.
#&gt;   cp_3 = MAXX  # mcp helper value.
#&gt; 
#&gt;   cp_1 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, 1) T(cp_0, MAXX)
#&gt;   cp_2 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, 1) T(cp_1, MAXX)
#&gt;   int_1 ~ dt(0, 1/(3*SDY)^2, 3) 
#&gt;   int_3 ~ dt(0, 1/(3*SDY)^2, 3) 
#&gt;   time_2 ~ dt(0, 1/(SDY/(MAXX-MINX))^2, 3) 
#&gt;   time_3 ~ dt(0, 1/(SDY/(MAXX-MINX))^2, 3) 
#&gt;   sigma_1 ~ dnorm(0, 1/(SDY)^2) T(0, )
#&gt; 
#&gt; 
#&gt;   # Model and likelihood
#&gt;   for (i_ in 1:length(time)) {
#&gt;     X_1_[i_] = min(time[i_], cp_1)
#&gt;     X_2_[i_] = min(time[i_], cp_2) - cp_1
#&gt;     X_3_[i_] = min(time[i_], cp_3) - cp_2
#&gt;     
#&gt;     # Fitted value
#&gt;     y_[i_] = 
#&gt;     
#&gt;       # Segment 1: response ~ 1
#&gt;       (time[i_] &gt;= cp_0) * (time[i_] &lt; cp_2) * int_1 + 
#&gt;     
#&gt;       # Segment 2: response ~ 1 ~ 0 + time
#&gt;       (time[i_] &gt;= cp_1) * (time[i_] &lt; cp_2) * time_2 * X_2_[i_] + 
#&gt;     
#&gt;       # Segment 3: response ~ 1 ~ 1 + time
#&gt;       (time[i_] &gt;= cp_2) * int_3 + 
#&gt;       (time[i_] &gt;= cp_2) * time_3 * X_3_[i_] 
#&gt;     
#&gt;     # Fitted standard deviation
#&gt;     sigma_[i_] = 
#&gt;       (time[i_] &gt;= cp_0) * sigma_1 
#&gt; 
#&gt;     # Likelihood and log-density for family = gaussian()
#&gt;     response[i_] ~ dnorm((y_[i_]), 1 / sigma_[i_]^2)
#&gt;     loglik_[i_] = logdensity.norm(response[i_], (y_[i_]), 1 / sigma_[i_]^2)
#&gt;   }
#&gt; }</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Jonas Kristoffer Lindeløv <a href='mailto:jonas@lindeloev.dk'>jonas@lindeloev.dk</a></p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://lindeloev.net'>Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


